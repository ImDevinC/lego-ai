<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brick Yourself</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #ffc107;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: #222;
    }
    main {
      margin: 2rem auto;
      max-width: 400px;
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    #drop-area {
      border: 2px dashed #ccc;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      cursor: pointer;
      position: relative;
    }
    #drop-area.hover {
      background: #eef;
    }
    #drop-area img {
      max-width: 100%;
      max-height: 200px;
      margin-top: 1rem;
      border-radius: 4px;
    }
    input, button {
      width: 100%;
      padding: 0.75rem;
      margin-bottom: 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      background: #28a745;
      color: white;
      cursor: pointer;
      border: none;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    #output {
      margin-top: 1.5rem;
    }
    #output img {
      max-width: 100%;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<header>Brick Yourself</header>

<main>
  <div id="drop-area">
    <p>Drop an image here or click to select.</p>
    <input type="file" id="file-input" accept="image/*" style="display:none;">
    <img id="preview" alt="" hidden>
  </div>

  <input type="text" id="api-key" placeholder="Enter your OpenAI API key">
  <button id="generate-btn" disabled>Generate</button>

  <div id="output"></div>
</main>

<script>
  const dropArea = document.getElementById('drop-area');
  const fileInput = document.getElementById('file-input');
  const previewImg = document.getElementById('preview');
  const apiKeyInput = document.getElementById('api-key');
  const generateBtn = document.getElementById('generate-btn');
  const output = document.getElementById('output');

  let selectedFile = null;

  // Enable click to select file
  dropArea.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', () => handleFiles(fileInput.files));

  // Drag/drop handlers
  ['dragenter','dragover','dragleave','drop'].forEach(event => {
    dropArea.addEventListener(event, preventDefaults, false);
  });
  ['dragenter','dragover'].forEach(event => {
    dropArea.addEventListener(event, () => dropArea.classList.add('hover'), false);
  });
  ['dragleave','drop'].forEach(event => {
    dropArea.addEventListener(event, () => dropArea.classList.remove('hover'), false);
  });

  dropArea.addEventListener('drop', e => {
    handleFiles(e.dataTransfer.files);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  function handleFiles(files) {
    if (files.length === 0) return;
    const file = files[0];
    if (!file.type.startsWith('image/')) return alert('Please upload an image');
    selectedFile = file;

    // Show preview
    const reader = new FileReader();
    reader.onload = e => {
      previewImg.src = e.target.result;
      previewImg.hidden = false;
    };
    reader.readAsDataURL(file);
    updateButtonState();
  }

  function updateButtonState() {
    generateBtn.disabled = !selectedFile || !apiKeyInput.value.trim();
  }

  apiKeyInput.addEventListener('input', updateButtonState);

  generateBtn.addEventListener('click', async () => {
    if (!selectedFile || !apiKeyInput.value.trim()) return;
    generateBtn.disabled = true;
    generateBtn.textContent = 'Generating...';

    try {
      const formData = new FormData();
      formData.append('image', selectedFile);
      formData.append('apiKey', apiKeyInput.value.trim());

      // Replace URL with your backend endpoint
      const res = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      if (!res.ok) throw new Error('Failed to generate');
      const blob = await res.blob();
      const imgUrl = URL.createObjectURL(blob);
      output.innerHTML = `<img src="${imgUrl}" alt="Brickified result">`;
    } catch (err) {
      alert(err.message);
    } finally {
      generateBtn.disabled = false;
      generateBtn.textContent = 'Generate';
    }
  });
</script>

</body>
</html>

